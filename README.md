# 🛸 Space Rover - Autonomous Environmental Analysis Robot

An autonomous rover that explores environments, detects obstacles using multi-camera vision and IR sensors, and collects soil and environmental data.

## 📋 Features

- **🎥 Multi-Camera Obstacle Detection**: 4 cameras (front, back, left, right) for 360° vision
- **🚧 IR Sensors**: Real-time obstacle detection in all directions
- **🌡️ Environmental Monitoring**: Temperature and humidity sensing (DHT11)
- **🌱 Soil Analysis**: pH measurement with voltage calibration
- **🗺️ Position Tracking**: Dead reckoning for coordinate mapping
- **📊 Data Logging**: JSON and CSV export with timestamps and positions
- **📈 Real-time Dashboard**: Streamlit web interface for data visualization
- **🤖 Autonomous Navigation**: Smart path planning with IR + camera fusion

---

## 📁 Project Structure

```
rover_project/
│
├── sensor_manager.py          # Sensor interface (DHT11, pH, IR)
├── motor_controller.py        # Motor control with L298N driver
├── obstacle_detector.py       # Multi-camera obstacle detection
├── rover_main.py              # Main control loop
├── streamlit_dashboard.py     # Data visualization dashboard
│
├── rover_config.json          # Configuration parameters
│
├── requirements.txt           # Desktop/laptop dependencies
├── requirements_rpi.txt       # Raspberry Pi dependencies
├── setup_rpi.sh              # Automated setup script for RPi
│
├── data/
│   ├── rover_data_log.json   # JSON data log
│   ├── rover_data.csv        # CSV export
│   ├── logs/                 # Additional logs
│   └── images/               # Captured camera frames
│
└── README.md                  # This file
```

---

## 🔧 Hardware Requirements

### Core Components
- **Raspberry Pi 4** (2GB+ RAM)
- **L298N Motor Driver** (x1 or x2)
- **DC Motors** with wheels (2 or 4)
- **IR Obstacle Sensors** (4x FC-51 or similar)
- **DHT11** Temperature & Humidity Sensor
- **pH Sensor** with ADS1115 ADC Module
- **USB Cameras** (4x)

### Power Supply
- 12V battery pack for motors (or 7.4V LiPo)
- 5V power bank for Raspberry Pi
- **Important**: Use separate power supplies!

### Other
- Jumper wires (M-F, M-M)
- Breadboard (optional, for prototyping)
- Rover chassis with wheels

---

## 🚀 Quick Start

### Option 1: Automated Setup (Recommended)

On your Raspberry Pi:

```bash
# 1. Clone or copy project files to Raspberry Pi
cd ~
mkdir rover_project
cd rover_project

# 2. Copy all Python files and requirements_rpi.txt here

# 3. Run automated setup
chmod +x setup_rpi.sh
bash setup_rpi.sh

# 4. Reboot
sudo reboot

# 5. Test sensors
python3 sensor_manager.py

# 6. Run the rover
python3 rover_main.py
```

### Option 2: Manual Setup

```bash
# Update system
sudo apt-get update && sudo apt-get upgrade -y

# Install system dependencies
sudo apt-get install -y python3-pip python3-opencv libgpiod2 i2c-tools

# Install Python packages
pip3 install -r requirements_rpi.txt

# Enable I2C
sudo raspi-config
# Navigate to: Interface Options → I2C → Enable

# Reboot
sudo reboot

# Verify I2C (should see device at 0x48 for ADS1115)
sudo i2cdetect -y 1
```

---

## 📊 Running the Dashboard

The dashboard can run on **any computer** (not just the Raspberry Pi). It reads the data files generated by the rover.

### On Desktop/Laptop:

```bash
# 1. Install dashboard dependencies
pip install -r requirements.txt

# 2. Copy data files from Raspberry Pi
scp pi@raspberrypi.local:~/rover_project/rover_data_log.json .
# OR just upload the file through the dashboard

# 3. Run dashboard
streamlit run streamlit_dashboard.py

# 4. Open browser to http://localhost:8501
```

### On Raspberry Pi (Optional):

```bash
# Install Streamlit on Pi (will be slow)
pip3 install streamlit

# Run dashboard
streamlit run streamlit_dashboard.py --server.address 0.0.0.0

# Access from another computer: http://raspberrypi.local:8501
```

---

## 🎮 Usage

### Running Individual Components

```bash
# Test sensors only
python3 sensor_manager.py

# Test motors only
python3 motor_controller.py

# Test camera detection only
python3 obstacle_detector.py
```

### Running Complete System

```bash
python3 rover_main.py
```

**Controls:**
- Press `Ctrl+C` to stop the rover safely
- All data is automatically saved

### Configuration

Edit `rover_config.json`:

```json
{
  "auto_study_enabled": true,     // Auto-study at intervals
  "study_interval": 30,            // Seconds between studies
  "default_speed": 50,             // Motor speed (0-100)
  "ir_priority": true,             // IR sensors override camera
  "log_to_file": true,             // Enable data logging
  "camera_resolution": [320, 240], // Camera resolution
  "min_obstacle_area": 1500        // Minimum contour area
}
```

---

## 🔌 Pin Connections

### Motor Driver (L298N)

| L298N Pin | Raspberry Pi GPIO |
|-----------|-------------------|
| ENA       | GPIO 13 (PWM)     |
| IN1       | GPIO 5            |
| IN2       | GPIO 6            |
| IN3       | GPIO 19           |
| IN4       | GPIO 26           |
| ENB       | GPIO 12 (PWM)     |

### IR Sensors

| Direction | GPIO Pin |
|-----------|----------|
| Front     | GPIO 17  |
| Back      | GPIO 27  |
| Left      | GPIO 22  |
| Right     | GPIO 23  |

### DHT11 Sensor

| DHT11 Pin | Raspberry Pi |
|-----------|--------------|
| VCC       | 3.3V         |
| GND       | GND          |
| DATA      | GPIO 4       |

### ADS1115 (pH Sensor ADC)

| ADS1115 Pin | Raspberry Pi |
|-------------|--------------|
| VDD         | 3.3V         |
| GND         | GND          |
| SCL         | GPIO 3 (SCL) |
| SDA         | GPIO 2 (SDA) |

**pH Sensor connects to ADS1115 A0 channel**

---

## 📈 Dashboard Features

### Real-time Monitoring
- **Current Status**: Temperature, humidity, pH, position, heading
- **Obstacle Detection**: Live status of all 4 IR sensors
- **Last Action**: Most recent rover movement

### Visualizations
1. **Path Map**: 2D plot of rover trajectory with study sites
2. **3D Path**: Position with pH values as height
3. **Environmental Charts**: Temperature and humidity over time
4. **Soil pH Analysis**: pH trends with reference lines
5. **Obstacle Heatmap**: Detection frequency by direction
6. **Action Distribution**: Pie chart of rover behaviors

### Data Export
- Download data as CSV
- View raw data table
- Filter by time range

---

## 🔬 Calibration

### pH Sensor Calibration

**Required**: pH 4, 7, and 10 calibration solutions

```python
from sensor_manager import SensorManager
import board

config = {
    'dht_pin': board.D4,
    'ir_pins': {'front': 17, 'back': 27, 'left': 22, 'right': 23},
    'adc_channel': 0
}

sensors = SensorManager(config)

# 1. Place probe in pH 4 solution
input("Place in pH 4, press Enter...")
ph4_v = sensors.read_ph_voltage()
print(f"pH 4 voltage: {ph4_v}V")

# 2. Rinse with distilled water, place in pH 7
input("Place in pH 7, press Enter...")
ph7_v = sensors.read_ph_voltage()
print(f"pH 7 voltage: {ph7_v}V")

# 3. Rinse, place in pH 10
input("Place in pH 10, press Enter...")
ph10_v = sensors.read_ph_voltage()
print(f"pH 10 voltage: {ph10_v}V")

# 4. Store calibration
sensors.calibrate_ph(ph4_v, ph7_v, ph10_v)
```

### Motor Speed Calibration

1. Mark starting position
2. Run motor forward for 10 seconds at 50% speed
3. Measure distance traveled
4. Update `distance_per_second` in `rover_main.py`:

```python
self.distance_per_second = measured_distance / 10  # meters
```

### IR Sensor Adjustment

Each IR sensor has a potentiometer to adjust detection distance:
- Turn clockwise: Increase range (up to ~30cm)
- Turn counter-clockwise: Decrease range (down to ~2cm)

Test by placing an object at desired distance and adjusting until LED lights up.

---

## 🐛 Troubleshooting

### Motors not running
- Check battery voltage (must be >7V)
- Verify common ground between Pi and motor driver
- Test GPIO pins: `gpio readall`
- Ensure PWM pins are enabled

### DHT11 timeout errors
```bash
# Install additional library
sudo apt-get install libgpiod2

# Try different GPIO pin (GPIO 17 instead of 4)
```

### pH sensor always reads same value
```bash
# Check I2C connection
sudo i2cdetect -y 1
# Should show device at 0x48

# Ensure probe is stored in storage solution
# Clean probe before use
```

### Cameras not detected
```bash
# List available cameras
ls /dev/video*

# Test individual camera
python3 -c "import cv2; cap = cv2.VideoCapture(0); print(cap.isOpened())"

# Add user to video group
sudo usermod -a -G video $USER
sudo reboot
```

### Permission denied errors
```bash
sudo usermod -a -G gpio,i2c,spi,video $USER
sudo reboot
```

### Dashboard not loading data
- Ensure data files exist: `ls rover_data_log.json`
- Check file permissions: `chmod 644 rover_data_log.json`
- Verify JSON format is valid

---

## 📊 Data Format

### JSON Log Entry
```json
{
  "timestamp": "2025-10-26T10:30:45.123456",
  "position": {"x": 1.5, "y": 0.8, "heading": 45.0},
  "temperature": 25.3,
  "humidity": 45.2,
  "soil_ph": 6.8,
  "soil_voltage": 2.1,
  "obstacles": {
    "front": false,
    "back": false,
    "left": true,
    "right": false
  },
  "action": "turn_right"
}
```

### CSV Export
Columns: timestamp, x, y, heading, temperature, humidity, soil_ph, action

---

## 🔒 Safety Notes

- **Never connect motor driver 5V OUT to Raspberry Pi**
- **Always use common ground** between Pi and motor driver
- **Keep pH probe in storage solution** when not in use
- **Don't run motors without load** (can damage driver)
- **Monitor battery voltage** (low voltage can cause erratic behavior)
- **Test components individually** before integration

---

## 🚀 Future Enhancements

- [ ] GPS module for absolute positioning
- [ ] Lidar sensor for accurate distance measurement
- [ ] Machine learning for terrain classification
- [ ] Solar panel for extended operation
- [ ] Radio telemetry for remote monitoring
- [ ] Additional soil sensors (moisture, conductivity)
- [ ] Automatic return-to-base feature

---

## 📝 License

This project is open source. Feel free to modify and distribute.

---

## 🤝 Contributing

Contributions welcome! Areas for improvement:
- Better position tracking algorithms
- Advanced obstacle avoidance
- Camera-based SLAM
- Additional sensor integrations

---

## 📧 Support

For issues or questions:
1. Check troubleshooting section above
2. Verify all connections match wiring diagram
3. Test components individually
4. Check error messages in console

---

## 🙏 Acknowledgments

Built using:
- OpenCV for computer vision
- Adafruit libraries for sensors
- Plotly and Streamlit for visualization
- RPi.GPIO for hardware control

---

**Happy Exploring! 🛸🌍**
